<div style="padding: 60px">
    <h4>Segment from {{start}}s to {{end}}s</h4>
    <div id="top_x_div"></div>
</div>

<script>
    google.charts.load('current', {
        'packages': ['bar']
    });
    google.charts.setOnLoadCallback(drawStuff);
    var instrument_names = ['Cello', 'Acoustic guitar', 'Electric guitar', 'Church organs', 'Piano', 'Violin']

    function drawStuff() {
        var results = JSON.parse("{{result}}");
        results = results.map(function(value, i) {
            return [instrument_names[i], value];
        });
        var header = [
            ['Instrument', 'Probability']
        ];
        data = header.concat(results);
        console.log(data);
        var data = new google.visualization.arrayToDataTable(data);

        var options = {
            width: 700,
            legend: {
                position: 'none'
            },
            axes: {
                x: {
                    0: {
                        side: 'top',
                    } // Top x-axis.
                }
            },
            bar: {
                groupWidth: "90%"
            }
        };

        var chart = new google.charts.Bar(document.getElementById('top_x_div'));
        // Convert the Classic options to Material options.
        chart.draw(data, google.charts.Bar.convertOptions(options));
    };

    // Add regions to waveform 
    results = JSON.parse("{{result}}");
    var maxValueIndex = -1;
    var maxValue = -1;
    for (var i = 0; i < 6; i++) {
        if (results[i] > maxValue) {
            maxValueIndex = i;
            maxValue = results[i];
        }
    }
    var dominantInstrumentName = instrument_names[maxValueIndex];
    console.log("dominant instrument: ", dominantInstrumentName);
    // Remove seleted region
    // And create identical but non-draggale
    wavesurfer.addRegion({
        id: "dominantInstrumentName",
        start: '{{ start }}', // time in seconds 
        end: '{{ end }}', // time in seconds 
        drag: false,
        resize: false,
        color: 'hsla(213, 92%, 85%, 0.48)',
        attributes: {
            label: dominantInstrumentName
        }
    });
    wavesurfer.regions.list["startend"].remove();
    // Add new, draggable region
    wavesurfer.addRegion({
        id: "startend",
        start: '{{ end }}', // time in seconds 
        end: '{{ end + 6 }}', // time in seconds 
        drag: true,
        resize: false,
        color: 'hsla(262, 52%, 47%, 0.48)',
    });
</script>